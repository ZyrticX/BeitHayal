# 🔒 ארכיטקטורת אבטחה - מערכת התאמה

## העיקרון המנחה

**הפרדה מוחלטת בין מידע אישי לנתוני התאמה**

```
┌─────────────────────────────────────────────────────────────┐
│                    רשת פנימית (מאובטחת)                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │           Excel/Salesforce מקומי                      │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │  מזהה  │  שם    │ טלפון  │ מייל  │ כתובת │    │   │
│  │  │  A123  │ ישראל  │ 050... │ @...  │ ת"א   │    │   │
│  │  │  A124  │ שרה    │ 052... │ @...  │ חיפה  │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                  │
│                           │ רק מזהים + קודים                 │
│                           ▼                                  │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ HTTPS (מוצפן)
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Supabase (ענן)                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  external_id │ gender │ city_code │ lang_code │     │   │
│  │  A123        │ M      │ TLV       │ UK        │     │   │
│  │  A124        │ F      │ HFA       │ RU        │     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ⚠️ אין כאן: שמות, טלפונים, מיילים, כתובות מלאות          │
└─────────────────────────────────────────────────────────────┘
```

---

## מה עולה לענן (Supabase)

| שדה | דוגמה | סיכון |
|-----|-------|-------|
| `external_id` | `0030700000j9Xp5` | מזהה טכני בלבד - חסר ערך ללא גישה ל-Salesforce |
| `gender` | `M` / `F` | לא מזהה באופן אישי |
| `city_code` | `TLV` / `HFA` | קוד עיר, לא כתובת מלאה |
| `region` | `center` / `north` | אזור כללי |
| `mother_tongue_code` | `UK` / `RU` | קוד שפה |
| `status` | `waiting` | סטטוס טכני |

---

## מה נשאר מקומי (Excel/Salesforce)

| שדה | סיבה |
|-----|------|
| שם מלא | מידע מזהה |
| טלפון | מידע מזהה |
| מייל | מידע מזהה |
| כתובת מלאה | מידע מזהה |
| תעודת זהות | מידע רגיש במיוחד |
| בקשות מיוחדות (טקסט חופשי) | עלול להכיל מידע אישי |
| הערות | עלול להכיל מידע אישי |

---

## תהליך העבודה המאובטח

### 1️⃣ העלאת נתונים

```
Excel מקומי
    │
    ├── טעינה לאפליקציה (בדפדפן)
    │
    ├── חילוץ רק שדות להתאמה:
    │   • external_id (מזהה Salesforce)
    │   • קוד מגדר
    │   • קוד עיר
    │   • קוד שפה
    │   • סטטוס
    │
    └── שליחה ל-Supabase (מוצפן HTTPS)
```

### 2️⃣ הרצת התאמה

```
Supabase
    │
    ├── אלגוריתם התאמה רץ על הקודים בלבד
    │
    ├── תוצאה: זוגות של external_id
    │   Student A123 ↔ Soldier B456
    │   (ציון: 85%)
    │
    └── שליחה חזרה לאפליקציה
```

### 3️⃣ הצגת תוצאות

```
אפליקציה (בדפדפן)
    │
    ├── קבלת זוגות מזהים מ-Supabase
    │
    ├── JOIN עם Excel המקומי (בזיכרון בלבד)
    │
    └── הצגה למשתמש עם שמות מלאים
```

---

## קודי ערים מומלצים

| קוד | עיר |
|-----|-----|
| TLV | תל אביב |
| JLM | ירושלים |
| HFA | חיפה |
| BSV | באר שבע |
| NTN | נתניה |
| RMG | רמת גן |
| PTK | פתח תקווה |
| HRZ | הרצליה |
| ASH | אשדוד |
| ASK | אשקלון |
| RLZ | ראשון לציון |
| HOL | חולון |
| BTY | בת ים |
| KFS | כפר סבא |
| RAN | רעננה |
| MOD | מודיעין |
| AFL | עפולה |
| KRM | כרמיאל |
| ELT | אילת |

---

## הגדרות אבטחה ב-Supabase

### 1. Row Level Security (RLS)
```sql
-- רק משתמשים מאומתים
ALTER TABLE students ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Auth only" ON students 
  FOR ALL TO authenticated USING (true);
```

### 2. אין גישה אנונימית
```sql
-- לא ליצור policies ל-anon!
-- REVOKE ALL ON students FROM anon;
```

### 3. אימות משתמשים
- השתמש ב-Supabase Auth
- הגדר MFA (אימות דו-שלבי)
- הגבל לדומיין ארגוני בלבד

---

## מה קורה אם Supabase נפרץ?

**התוקף יקבל:**
```
external_id: 0030700000j9Xp5
gender: M
city_code: TLV
lang_code: UK
```

**התוקף לא יקבל:**
- שמות
- טלפונים
- מיילים
- כתובות
- תעודות זהות

**הנזק מוגבל** - המידע חסר ערך ללא גישה ל-Salesforce הארגוני.

---

## צ'קליסט אבטחה

- [ ] RLS מופעל על כל הטבלאות
- [ ] אין policies ל-anon
- [ ] Supabase Auth מוגדר עם MFA
- [ ] HTTPS בלבד
- [ ] אין מידע אישי בטבלאות
- [ ] קבצי Excel נשארים מקומיים
- [ ] לוגים מאופשרים למעקב
- [ ] גיבויים מוצפנים
