# 🔒 מערכת התאמה מאובטחת - סטודנטים וחיילים

מערכת להתאמת מתנדבים (סטודנטים) לחיילים על בסיס קריטריונים מותאמים, **עם הפרדה מוחלטת בין מידע אישי לנתוני התאמה**.

## 🛡️ עיקרון האבטחה

```
┌─────────────────────────────────────────┐
│         מחשב מקומי (מאובטח)              │
│  ┌─────────────────────────────────┐    │
│  │  Excel: שמות, טלפונים, מיילים   │    │
│  │  נשאר כאן - לא עולה לענן!       │    │
│  └─────────────────────────────────┘    │
│                  │                       │
│                  │ רק קודים              │
│                  ▼                       │
└─────────────────────────────────────────┘
                   │ HTTPS
                   ▼
┌─────────────────────────────────────────┐
│           Supabase (ענן)                 │
│  ┌─────────────────────────────────┐    │
│  │  קודים בלבד: TLV, RU, M         │    │
│  │  אין שמות, אין טלפונים          │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

## 📦 תכונות

- 📤 **העלאת קבצי אקסל** - העלאת רשימות סטודנטים וחיילים
- 🔍 **אלגוריתם התאמה חכם** - מבוסס על שפה, מיקום, העדפות
- 🔒 **אבטחת מידע** - מידע אישי נשאר מקומי בלבד
- 📊 **דשבורד** - סקירה סטטיסטית של הנתונים
- ✅ **ניהול התאמות** - אישור/דחייה של התאמות מוצעות
- 📥 **ייצוא לאקסל** - הורדת תוצאות ההתאמה (מזהים בלבד)

## 🔐 מה נשמר היכן?

### 🏠 נשאר מקומי (Excel/דפדפן)
| שדה | סיבה |
|-----|------|
| שם מלא | מידע מזהה |
| טלפון | מידע מזהה |
| מייל | מידע מזהה |
| כתובת מלאה | מידע מזהה |
| בקשות מיוחדות (טקסט) | עלול להכיל מידע אישי |
| הערות | עלול להכיל מידע אישי |

### ☁️ עולה לענן (Supabase)
| שדה | דוגמה | סיכון |
|-----|-------|-------|
| external_id | `0030700000j9Xp5` | מזהה טכני בלבד |
| gender | `M` / `F` | לא מזהה |
| city_code | `TLV` / `HFA` | קוד עיר בלבד |
| region | `center` / `north` | אזור כללי |
| mother_tongue_code | `UK` / `RU` | קוד שפה |
| status | `waiting` | סטטוס טכני |

## 🚀 התקנה

### 1. Clone והתקנת תלויות

```bash
git clone <repo-url>
cd matching-system
npm install
```

### 2. הגדרת Supabase

1. צור פרויקט חדש ב-[Supabase](https://supabase.com)
2. הרץ את הסקריפט `supabase-schema-secure.sql` ב-SQL Editor
3. העתק את `SUPABASE_URL` ו-`SUPABASE_ANON_KEY` מההגדרות

### 3. הגדרת משתני סביבה

צור קובץ `.env` בתיקיית השורש:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

### 4. הרצה מקומית

```bash
npm run dev
```

## 🗂️ מבנה הקבצים

```
matching-system/
├── src/
│   ├── components/
│   │   ├── Dashboard.tsx      # דשבורד סטטיסטי
│   │   ├── UploadPanel.tsx    # העלאת קבצים
│   │   ├── StudentsTable.tsx  # טבלת סטודנטים
│   │   ├── SoldiersTable.tsx  # טבלת חיילים
│   │   └── MatchesPanel.tsx   # ניהול התאמות
│   ├── lib/
│   │   ├── supabase-secure.ts      # טיפוסים מאובטחים
│   │   ├── excelParser-secure.ts   # פרסור אקסל מאובטח
│   │   ├── matchingAlgorithm-secure.ts # אלגוריתם מאובטח
│   │   └── cityDistance.ts         # חישוב מרחקים
│   └── App.tsx
├── supabase-schema-secure.sql      # סכמה מאובטחת
└── SECURITY-ARCHITECTURE.md        # תיעוד אבטחה
```

## 📋 קריטריונים להתאמה

1. **שפת אם** (35%) - חובה התאמה, אלא אם המרחק קטן מ-50 ק"מ
2. **מרחק גיאוגרפי** (25%) - עד 150 ק"מ מקסימום
3. **העדפת מגדר** (15%) - מתנדב/מתנדבת/לא חשוב
4. **בקשות מיוחדות** (15%) - דגל בלבד (לא הטקסט)
5. **זמינות** (10%) - מקומות פנויים אצל הסטודנט

## 🔧 שימוש

### 1. העלאת נתונים
1. עבור ללשונית "העלאת קבצים"
2. העלה קובץ סטודנטים (xlsx)
3. העלה קובץ חיילים (xlsx)

### 2. הרצת התאמה
1. עבור ללשונית "התאמות"
2. לחץ על "הרץ התאמה"
3. האלגוריתם עובד על **קודים בלבד** - לא על מידע אישי

### 3. צפייה בתוצאות
- השמות המלאים מוצגים מה-JOIN המקומי בדפדפן
- ניתן להציג/להסתיר את הקודים שעולים לענן

### 4. ייצוא
- הייצוא מכיל **מזהים בלבד** - לא מידע אישי

## 🛡️ הגדרות אבטחה ב-Supabase

### Row Level Security (RLS)
```sql
ALTER TABLE students ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Auth only" ON students 
  FOR ALL TO authenticated USING (true);
```

### אין גישה אנונימית
```sql
-- לא ליצור policies ל-anon!
REVOKE ALL ON students FROM anon;
```

## ❓ מה קורה אם Supabase נפרץ?

**התוקף יקבל:**
```
external_id: 0030700000j9Xp5
gender: M
city_code: TLV
lang_code: UK
```

**התוקף לא יקבל:**
- שמות
- טלפונים
- מיילים
- כתובות

**הנזק מוגבל** - המידע חסר ערך ללא גישה ל-Salesforce הארגוני.

## ✅ צ'קליסט אבטחה

- [x] RLS מופעל על כל הטבלאות
- [x] אין policies ל-anon
- [x] Supabase Auth מוגדר
- [x] HTTPS בלבד
- [x] אין מידע אישי בטבלאות הענן
- [x] קבצי Excel נשארים מקומיים
- [x] הייצוא מכיל מזהים בלבד

## 🛠️ טכנולוגיות

- **Frontend**: React + TypeScript + Vite
- **Backend**: Supabase (PostgreSQL)
- **Icons**: Lucide React
- **Excel**: SheetJS (xlsx)

## 📜 רישיון

MIT
